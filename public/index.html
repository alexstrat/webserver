<html>
<head>

<LINK REL="StyleSheet" HREF="./css/styles.css" TYPE="text/css" MEDIA=screen></LINK>
<script src="/js/jQuery.js" type="text/javascript"></script>
<script src="/js/smoothie.js" type="text/javascript"></script>
<script src="/js/feed.js" type="text/javascript"></script>
<script src="/js/pinger.js" type="text/javascript"></script>

<script src="/dnode.js" type="text/javascript"></script>

<script type="text/javascript">

    var connected = false, t;

    $(document).ready(function(){

      var client = DNode({
        
        input: function(source, event, data){
          if(data){
            $('.loading').hide();
            //renderFeed(event, data);
            renderPinger(event, data);
          }
        },
        
        report: function(message){
          $('#server-name').html(message.toString());
        }
        
      });


      function connect() {

        client.on('error', function(){
          console.log('crap');
        });

        client.connect(function (remote, conn) {
            clearInterval(t);
            conn.on('end', function(){
              //
              //  Attempt reconnection
              //
              t = setInterval(function(){
                console.log('interval attempting to connect');
                connect();
              }, 3000)
            });
            remote.input('o.message', 'i am browser');
        });
      }

      connect();

    });

</script>
</head>
<body>
  <div align="center" class="wrap">
    <div align="right" style="width:750px;">
      <h1 id ="server-name">loading...</h1>
    </div>
    <canvas id="chart" width="748" height="200" ><img class="loading" src="./img/loading-clock.gif"></img></canvas>
    <img class="loading" src="./img/loading-clock.gif"></img>
    <ul id ="pinger"></ul>
  </div>
</body>
</html>
